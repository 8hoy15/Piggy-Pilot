<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Piggy Pilot</title>
  <link rel="stylesheet" href="piggy-style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <a href="main.html"><div class="banner"><h1><center>Welcome to Piggy Pilot!</center></h1></div></a>
  <link rel="icon" type="image/png" href="piggy-icon.png">
</head>
<body>

  <!-- Chatbox below -->
  <div class="banner1">
    <div id="chatbox">
      <div id="messages"></div>
      <input id="userInput" type="text" placeholder="Ask Piggy Pilot..." />
      <button onclick="askGemini()">Send</button>
    </div>
  </div>

  
</body>
</html>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
  const messagesDiv = document.getElementById("messages");

  // Initial AI greeting
  window.addEventListener("DOMContentLoaded", () => {
    messagesDiv.innerHTML += `<div class="msg-ai"><b>PiggyPilot:</b> Hey! I'm here to assist you with your finances. Ask me anything about budgeting, saving, or money management.</div>`;
  });

  async function askGemini() {
    const input = document.getElementById("userInput");
    const userMessage = input.value.trim();
    if (!userMessage) return;

    // Show user message
    messagesDiv.innerHTML += `<div class="msg-user"><b>You:</b> ${userMessage}</div>`;
    input.value = "";

    try {
      // Prefix the user message with finance-only instructions
      const prompt = `You are PiggyPilot, an AI that ONLY gives advice about personal finance, budgeting, or money management. Answer concisely. Question: ${userMessage}`;

      const res = await fetch(
        "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDsZxN5e9oov49QxYLxFR2KbsebJIci3UE",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        }
      );

      const data = await res.json();
      const aiRaw = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response";

      // Render AI response as Markdown
      const aiResponseHTML = marked.parse(aiRaw);

      messagesDiv.innerHTML += `<div class="msg-ai"><b>PiggyPilot:</b> ${aiResponseHTML}</div>`;
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    } catch (err) {
      messagesDiv.innerHTML += `<div class="msg-ai"><b>PiggyPilot:</b> Error contacting API</div>`;
    }
  }
  const input = document.getElementById("userInput");

// Listen for Enter key
input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    e.preventDefault(); // prevent form submission if inside a form
    askGemini();
  }
});
</script>